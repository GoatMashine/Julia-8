# Initialization
mem = zeros(UInt8, 4096)
v = zeros(UInt8, 16)
stack = zeros(UInt16, 16) 
I = zero(UInt16) 
pc = zero(UInt16)
screen = falses(32, 64)

font = [
    0xF0, 0x90, 0x90, 0x90, 0xF0, # 0
    0x20, 0x60, 0x20, 0x20, 0x70, # 1
    0xF0, 0x10, 0xF0, 0x80, 0xF0, # 2
    0xF0, 0x10, 0xF0, 0x10, 0xF0, # 3
    0x90, 0x90, 0xF0, 0x10, 0x10, # 4
    0xF0, 0x80, 0xF0, 0x10, 0xF0, # 5
    0xF0, 0x80, 0xF0, 0x90, 0xF0, # 6
    0xF0, 0x10, 0x20, 0x40, 0x40, # 7
    0xF0, 0x90, 0xF0, 0x90, 0xF0, # 8
    0xF0, 0x90, 0xF0, 0x10, 0xF0, # 9
    0xF0, 0x90, 0xF0, 0x90, 0x90, # A
    0xE0, 0x90, 0xE0, 0x90, 0xE0, # B
    0xF0, 0x80, 0x80, 0x80, 0xF0, # C
    0xE0, 0x90, 0x90, 0x90, 0xE0, # D
    0xF0, 0x80, 0xF0, 0x80, 0xF0, # E
    0xF0, 0x80, 0xF0, 0x80, 0x80  # F
]

for i in eachindex(font)
    mem[0x50 + i] = font[i]
end    

pc = 0x201


# main F/D/E Loop
while true
    opcode = (UInt16(mem[pc]) << 8) | mem[pc + 1]
    nib1 = UInt8((opcode >> 12) & 0xF)
    nib2 = UInt8((opcode >> 8) & 0xF)
    nib3 = UInt8((opcode >> 4) & 0xF)
    nib4 = UInt8(opcode & 0xF)
    if nib1 == 0x0
        print(0)
    elseif nib1 == 0x1
        print(1)
    elseif nib1 == 0x2
        print(2)
    elseif nib1 == 0x3
        print(3)
    elseif nib1 == 0x4
        print(4)
    elseif nib1 == 0x5
        print(5)
    elseif nib1 == 0x6
        print(6)
    elseif nib1 == 0x7
        print(7)
    elseif nib1 == 0x8
        print(8)
    elseif nib1 == 0x9
        print(9)
    elseif nib1 == 0xA
        print("A")
    elseif nib1 == 0xB
        print(0xB)
    elseif nib1 == 0xC
        print(0xC)
    elseif nib1 == 0xD
        print(0xD)
    elseif nib1 == 0xE
        print(0xE)
    elseif nib1 == 0xF
        print(0xF)   
    end    
end    